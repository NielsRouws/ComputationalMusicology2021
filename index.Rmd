---
title: "Portfolio"
author: "Niels Rouws, 12177555"
date: "2/10/2021"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

PLEASE DO NOT SHOW THIS PORTFOLIO IN CLASS

```{r, echo=FALSE, results='hide', warning=FALSE, message=FALSE}

library(tidyverse)
library(spotifyr)
library(flexdashboard)
library(plotly)
library(compmus)

```

```{r, echo=FALSE, cache=TRUE}
rock60s <- get_playlist_audio_features("", "37i9dQZF1DWWzBc3TOlaAV") %>% add_audio_analysis()
rock70s <- get_playlist_audio_features("", "37i9dQZF1DWWwzidNQX6jx") %>% add_audio_analysis()
rock80s <- get_playlist_audio_features("", "37i9dQZF1DX1spT6G94GFC") %>% add_audio_analysis()
rock90s <- get_playlist_audio_features("", "37i9dQZF1DX1rVvRgjX59F") %>% add_audio_analysis()
rock00s <- get_playlist_audio_features("", "37i9dQZF1DX3oM43CtKnRV") %>% add_audio_analysis()
rock10s <- get_playlist_audio_features("", "37i9dQZF1DX99DRG9N39X3") %>% add_audio_analysis()


rock <-
  bind_rows(
    rock60s %>% mutate(category = "1960s"),
    rock70s %>% mutate(category = "1970s"),
    rock80s %>% mutate(category = "1980s"),
    rock90s %>% mutate(category = "1990s"),
    rock00s %>% mutate(category = "2000s"),
    rock10s %>% mutate(category = "2010s")
  ) %>%
  mutate(
    mode = ifelse(mode == 0, "Minor", "Major")
  )

```

```{r, echo=FALSE}

circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )
```

Tempo
=========================================

### Led Zeppelin - Stairway to Heaven


```{r, echo=FALSE, cache=TRUE}

zeppelin <- get_tidy_audio_analysis("5CQ30WqJwcep0pYcV4AMNc")

zeppelin %>%
  tempogram(window_size = 8, hop_size = 1, cyclic = FALSE) %>%
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(title = "Tempogram Led Zeppelin - Stairway to Heaven", x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()

```


### Queen - Bohemian Rhapsody

```{r, echo=FALSE, cache=TRUE}

rhapsody <- get_tidy_audio_analysis("2GAIycsMaDVtMtdvxzR2xI")

rhapsody %>%
  tempogram(window_size = 8, hop_size = 1, cyclic = FALSE) %>%
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(title = "Tempogram Queen - Bohemian Rhapsody", x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()

```



### Analysis

Two iconic rock numbers have interesting tempi changes. Stairway to Heaven has 
a constantly increasing tempo. Starting around 71 BPM the tempo bumps up to 
around 82 BPM and continues to increase. At the end of verse 6, or 330 seconds,
a transition and solo follow that have a peak BPM of just over 100 BPM. 

Bohemian Rhapsody has iconic sections of different genres in the same song.
The tempo change that stands out the most is the operatic section with a BPM of 
146 starting around 190 seconds and ending around 240 seconds.


Introduction
=========================================

### Comparing the Rock genre over fours decades 60s-10s

Spotify has 6 playlist called the XXs Rock Anthems for the decades 60s, 70s, 80s, 90s, 00s, and 10s. I'm interested
in how rock has evolved from the 60s to the 10s. Multiple bands have made music spanning more than one decade
and I would like to investigate how their earlier work compares to their later works and whether bands have
influenced each other. Moreover when large subgenres of rock started to appear and which bands were responsible. 
There are three main groups to compare: the early bands from the 60s and 70s, the middle 
80 and 90s bands, and late 00s and 10s. 

The use of more digital elements in music will probably increase over the years, and more subgenres are likely to have
emerged over the years. I am unsure in what way the bands have influenced each other if any at all.

The tracks are all popular songs from their respective time periods but not all songs are original. 
Especially among the older songs are a lot of remastered versions. Another downside is the small 
amount of songs representing a complete decade of song releases. 

Atypical bands might be bands like Queen which is known for releasing songs in a multitude of genres 
and bands that have released albums spanning multiple decades. Typical bands might be bands like U2 that appear 
in one playlist with multiple songs.




Analysis {.storyboard}
=========================================

### The corpus

```{r, echo=FALSE}
ggplot(
  rock,
  aes(
    x = category,
    fill = category
  )
) +
  geom_bar() + 
  labs(
    title = "Amount of songs per decennium"
  )

```

***

The current corpus has a lack of data representing the last two decades and the 
90s are over-represented. Furthermore the current data might not be the best 
to represent the decennia since they have not yet been verified using the 
hit-charts of their respective decade.

### Acousticness


```{r, echo=FALSE}

ggplot(
  rock,
  aes(
    x = category,
    y = acousticness, 
    fill = mode
  )
) +
  geom_boxplot(
    position = position_dodge(width = 0.5),
    outlier.alpha = 0.6,
  ) +
  geom_text(aes(label=ifelse(track.name=="Way down We Go", "Way down We Go", "")), hjust = 0.8, vjust=0) +
  theme(legend.position = c(0.9, 0.9)) +
  labs(title = " Distribution of acousticness per decennia per mode")

```

***

The current data shows that over the years the acousticness has significantly 
decreased. From the 1980s a significant drop in acousticness can be seen in 
the data. The 1960s and 1970s show a wide distribution which narrows and shifts
towards no acousticness at all. The 2000s seems the decade with the least
acousticness as even the outliers don't exceed 0.12 on the scale. The 2010s see
the acoustic outliers returning with "Way down We Go" from KALEO as most
acoustic song.


The distribution along the modes don't seem to have a significant preference for
more or less acousticness only the 1960s and 1980s show dissimilar
distributions per mode. Minor songs favor more acousticsness in the 1960s and
the 1980s is reversed, favoring less acousticness.


### Valence 



```{r, echo=FALSE}
ggplot(
  rock,
  aes(
    x = category,
    y = valence, 
    fill = mode
  )
) +
  geom_boxplot(
    position = position_dodge(width = 0.5),
    outlier.alpha = 0.6,
  ) +
  theme(legend.position = c(0.9, 0.9)) +
  labs(title = "Distribution of valence per decennia per mode")
```

***

The valence appears to barely have changed in the first three decades with a 
small drop to the last three decades.

### Loudness & Energy


```{r, echo=FALSE}
plot_le <- ggplot(
  rock,
  aes(
    x = loudness,
    y = energy,
    color = category,
    name = track.name
  )
) +
  geom_smooth(method = "loess", formula = "y ~ x") + 
  geom_point(alpha = 0.4) +
  facet_wrap(~category) +
  theme(legend.position = "none") +
  labs(
    title = "Energy related to loudness per decennium."
  )


ggplotly(plot_le, tooltip=c("track.name", "x", "y"))

```

***

Comparing the energy related to loudness per decade show very similar clouds of
data points. The 2000s and 2010s appear to lack songs in the lower ranges of 
loudness but this could be due to the fact that the playlists have less data
points.



Self-Similarity
=========================================

### Pink Floyd

```{r, echo=FALSE, cache=TRUE}

floyd <-
  get_tidy_audio_analysis("5HNCy40Ni5BZJFw1TKzRsC") %>%
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
)

bind_rows(
  floyd %>%
    compmus_self_similarity(pitches, "aitchison") %>%
    mutate(d = d / max(d), type = "Chroma"),
  floyd %>%
    compmus_self_similarity(timbre, "euclidean") %>%
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_light() +
  labs(title = "Comfortably Numb - Pink Floyd", x = "Time (min)", y = "Time (min)") +
  scale_y_time() +
  scale_x_time()

```

### Muse


```{r, echo=FALSE, cache=TRUE}

muse <-
  get_tidy_audio_analysis("3lPr8ghNDBLc2uZovNyLs9") %>%
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  )


bind_rows(
  muse %>%
    compmus_self_similarity(pitches, "aitchison") %>%
    mutate(d = d / max(d), type = "Chroma"),
  muse %>%
    compmus_self_similarity(timbre, "euclidean") %>%
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_light() +
  labs(title = "Supermassive Black Hole - Muse", x = "Time (min)", y = "Time (min)") +
  scale_y_time() +
  scale_x_time()

```

### Comparising "Comfortably Numb" and "Supermassive Black Hole"

Pink Floyd's Comfortably Numb from the 70s and Muse's are both classic rock
songs and share some similarities as can be seen in their self-similarity 
matrices. 

Patterns that emerge from the chroma-based self-similarity matrices are short 
dark diagonal paths. Especially looking a Muse's song we can clearly see
the same blocks with these paths each time the pre-chorus and chorus play.
The darker blocks are the verses characterized as a riff with vocals. The timbre-based changes show comparable patterns but have a clear difference around the 2:30. This is when the guitar solo plays and is clearly unique from other parts of the song. 

The changes in Comfortably Numb are less obvious but the pattern is checkerboard-like as in Muse's song. Easiest to spot are the transitions from intro around the 1 minute mark and to the long outro solo around the 4:30 minutes.


Track-level analysis
=========================================

### Tempo


```{r, echo=FALSE}

rock %>%
  mutate(
    sections =
      map(
        sections,                                    # sections or segments
        summarise_at,
        vars(tempo, loudness, duration),             # features of interest
        list(section_mean = mean, section_sd = sd)   # aggregation functions
      )
  ) %>%
  unnest(sections) %>%
  ggplot(
    aes(
      x = tempo,
      y = tempo_section_sd,
      colour = category,
      alpha = loudness
    )
  ) +
  geom_point(aes(size = duration / 60)) +
  geom_rug() +
  facet_wrap(~category) +
  theme_minimal() +
  ylim(0, 5) +
  labs(
    x = "Mean Tempo (bpm)",
    y = "SD Tempo",
    colour = "Decade",
    size = "Duration (min)",
    alpha = "Volume (dBFS)"
  )

```

### Analysis

Changes in mean tempo and standard deviation can seen. The 60s has a
dense cloud around 140 BPM with a standard deviation just below 2. In the 70s 
the dense cloud has dispersed but the center is still around these values. The 
following two decades see the distribution shift towards lower tempos and less
variability. From the 00s onward especially the variability in tempo has
decreased with only a few exceeding a standard deviation of 2. The mean tempo
is more spread out compared the 80s and 90s that are skewed towards lower tempo.


